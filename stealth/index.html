<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Roulette • Stealth Text Mode • v0.7</title>
<style>
:root{color-scheme:dark; --bg:#0b1220; --card:#0f1a2e; --muted:#94a3b8; --txt:#e5e7eb; --border:#1f2a44; --me:#1d4ed8; --me2:#1e3a8a; --them:#111827;}
*{box-sizing:border-box}
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:linear-gradient(180deg,#070b14,#0b1220 40%,#070b14);color:var(--txt)}
.wrap{max-width:760px;margin:0 auto;min-height:100vh;display:flex;flex-direction:column}
.header{padding:10px 14px 6px;border-bottom:1px solid rgba(255,255,255,.06);position:sticky;top:0;background:rgba(11,18,32,.92);backdrop-filter:blur(10px);z-index:3}
.h1{font-weight:800;font-size:20px;margin:2px 0 0 0;letter-spacing:.2px}
.sub{color:var(--muted);font-size:12px;margin-top:3px}
.thread{padding:10px 12px 110px;flex:1}
.row{display:flex;gap:10px;margin:10px 0;align-items:flex-end}
.row.me{justify-content:flex-end}
.bubble{max-width:min(540px, 86%);padding:10px 12px;border-radius:18px;line-height:1.28;box-shadow:0 10px 24px rgba(0,0,0,.22);border:1px solid rgba(255,255,255,.08)}
.bubble.them{background:rgba(17,24,39,.88)}
.bubble.me{background:linear-gradient(180deg,rgba(29,78,216,.95),rgba(30,58,138,.95));}
.meta{font-size:11px;color:rgba(255,255,255,.72);margin-top:6px}
.pill{display:inline-block;padding:1px 8px;border-radius:999px;border:1px solid rgba(255,255,255,.14);font-size:11px;color:rgba(255,255,255,.85);margin-left:6px}
.mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
hr{border:none;border-top:1px solid rgba(255,255,255,.08);margin:10px 0}
.footer{position:fixed;left:0;right:0;bottom:0;background:rgba(11,18,32,.95);backdrop-filter:blur(12px);border-top:1px solid rgba(255,255,255,.07);padding:10px 12px}
.composer{max-width:760px;margin:0 auto;display:flex;gap:10px;align-items:center}
input[type=text]{flex:1;border-radius:18px;border:1px solid var(--border);background:#0b152b;color:var(--txt);padding:12px 14px;font-size:16px}
button{border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.08);color:var(--txt);padding:10px 14px;border-radius:16px;font-weight:800;cursor:pointer}
button:active{transform:translateY(1px)}
.smallhint{position:fixed;left:0;right:0;bottom:64px;max-width:760px;margin:0 auto;padding:0 12px}
.smallhint .note{font-size:12px;color:rgba(255,255,255,.75);padding:8px 10px;border-radius:14px;border:1px solid rgba(255,255,255,.08);background:rgba(17,24,39,.55)}
</style>
</head>
<body>
<div class="wrap">
  <div class="header">
    <div class="h1">Scott</div>
    <div class="sub">Texting view • STEALTH TEXT MODE — v0.7 (rebuild) • 2026-01-04</div>
  </div>

  <div id="thread" class="thread"></div>

  <div class="smallhint">
    <div class="note">
      Paste history as comma-separated numbers (example: <span class="mono">0,00,34,23,5,17</span>) then tap <b>Send</b>.
      Commands: <b>status</b>, <b>trend</b>, <b>explain</b>, <b>explain2</b>, <b>wheel</b>, <b>export</b>, <b>offline</b>, <b>clear</b>.
    </div>
  </div>

  <div class="footer">
    <form id="form" class="composer" autocomplete="off">
      <input id="in" type="text" placeholder="Type a spin, command, or paste history..." inputmode="text"/>
      <button id="send" type="submit">Send</button>
    </form>
  </div>
</div>

<script>
(() => {
  "use strict";

  const STORAGE_KEY = "roulette_stealth_v0_7";
  const WHEEL = [0,28,9,26,30,11,7,20,32,17,5,22,34,15,3,24,36,13,1,"00",27,10,25,29,12,8,19,31,18,6,21,33,16,4,23,35,14,2];
  const RED = new Set([1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36]);
  const BLACK = new Set([2,4,6,8,10,11,13,15,17,20,22,24,26,28,29,31,33,35]);
  const GN = new Set(["00",0,1,2,9,10,13,14,27,28]);
  const HO = new Set([24,25,26,29,30,33,34,35,36]);
  const LO = new Set([3,4,8,11,12,15,16,22,23]);
  const MID= new Set([5,6,7,17,18,19,20,21,31,32]);

  const $ = (id) => document.getElementById(id);
  const thread = $("thread");
  const input = $("in");
  const form = $("form");

  let spins = [];         // newest-first, values are 0..36 or "00"
  let casino = "";        // optional
  let awaitingCasino = false;

  function escapeHtml(s){
    return String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
  }

  function addBubble(text, who="them", meta="") {
    const row = document.createElement("div");
    row.className = "row " + (who==="me" ? "me" : "them");
    const b = document.createElement("div");
    b.className = "bubble " + (who==="me" ? "me" : "them");
    b.innerHTML = text;
    if(meta){
      const m = document.createElement("div");
      m.className = "meta";
      m.textContent = meta;
      b.appendChild(m);
    }
    row.appendChild(b);
    thread.appendChild(row);
    window.scrollTo(0, document.body.scrollHeight);
  }

  function save(){
    try {
      localStorage.setItem(STORAGE_KEY, JSON.stringify({spins, casino}));
    } catch(e) {}
  }

  function load(){
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return;
      const obj = JSON.parse(raw);
      if(Array.isArray(obj.spins)) spins = obj.spins.slice(0,5000);
      if(typeof obj.casino === "string") casino = obj.casino;
    } catch(e) {}
  }

  function parseToken(tok){
    const t = String(tok).trim();
    if(!t) return null;
    if(t === "00") return "00";
    if(!/^[0-9]+$/.test(t)) return null;
    const n = Number(t);
    if(!Number.isFinite(n)) return null;
    if(n === 0) return 0;
    if(n >= 1 && n <= 36) return n;
    return null;
  }

  function parseList(text){
    const parts = String(text).split(",").map(s=>s.trim()).filter(Boolean);
    const out = [];
    for(const p of parts){
      const v = parseToken(p);
      if(v===null) return null;
      out.push(v);
    }
    return out;
  }

  function isGreen(n){ return (n==="00" || n===0); }
  function isRed(n){ return (n!=="00" && n!==0 && RED.has(Number(n))); }
  function isBlack(n){ return (n!=="00" && n!==0 && BLACK.has(Number(n))); }
  function isHigh(n){ return (n!=="00" && n!==0 && Number(n)>=19); }
  function isLow(n){ return (n!=="00" && n!==0 && Number(n)>=1 && Number(n)<=18); }
  function isEven(n){ return (n!=="00" && n!==0 && Number(n)%2===0); }
  function isOdd(n){ return (n!=="00" && Number(n)%2===1); }

  function colOf(n){
    if(n==="00" || n===0) return null;
    const v = Number(n);
    const r = v % 3;
    return r===1 ? 1 : (r===2 ? 2 : 3);
  }
  function dozenOf(n){
    if(n==="00" || n===0) return null;
    const v = Number(n);
    return v<=12 ? 1 : (v<=24 ? 2 : 3);
  }
  function streetId(n){
    if(n==="00" || n===0) return null;
    const v = Number(n);
    return Math.floor((v-1)/3) + 1; // 1..12
  }
  function junkoBucket(n){
    const k = (n==="00") ? "00" : Number(n);
    if(GN.has(k)) return "GN";
    if(HO.has(k)) return "HO";
    if(LO.has(k)) return "LO";
    if(MID.has(k)) return "M";
    return null;
  }
  function dsKey(n){
    if(n==="00" || n===0) return null;
    const v = Number(n);
    const d = v<=12 ? 1 : (v<=24 ? 2 : 3);
    const base = (d-1)*12;
    const a=base+1, b=base+4, c=base+7;
    if(v>=a && v<=a+5) return {d, i:1};
    if(v>=b && v<=b+5) return {d, i:2};
    if(v>=c && v<=c+5) return {d, i:3};
    return {d, i:2};
  }

  function counts(vals){
    const c = {
      c1:0,c2:0,c3:0, d1:0,d2:0,d3:0,
      red:0,black:0, high:0,low:0, even:0,odd:0,
      gn:0,ho:0,lo:0,m:0, green:0
    };
    for(const n of vals){
      if(isGreen(n)) c.green++;
      const col = colOf(n); if(col===1)c.c1++; if(col===2)c.c2++; if(col===3)c.c3++;
      const dz = dozenOf(n); if(dz===1)c.d1++; if(dz===2)c.d2++; if(dz===3)c.d3++;
      if(isRed(n)) c.red++;
      if(isBlack(n)) c.black++;
      if(isHigh(n)) c.high++;
      if(isLow(n)) c.low++;
      if(isEven(n)) c.even++;
      if(isOdd(n)) c.odd++;
      const jb = junkoBucket(n);
      if(jb==="GN") c.gn++;
      if(jb==="HO") c.ho++;
      if(jb==="LO") c.lo++;
      if(jb==="M") c.m++;
    }
    return c;
  }

  function dsCounts(vals){
    const out = {d1:[0,0,0], d2:[0,0,0], d3:[0,0,0]};
    for(const n of vals){
      const k = dsKey(n);
      if(!k) continue;
      const arr = (k.d===1?out.d1:(k.d===2?out.d2:out.d3));
      arr[k.i-1] += 1;
    }
    return out;
  }

  function repeatInfo(vals, lookback){
    const newest = vals[0];
    for(let i=1;i<Math.min(vals.length, lookback+1);i++) {
      if(vals[i]===newest) return `Number ${String(newest)} repeated within ${i} spins`;
    }
    return null;
  }
  function repeatStreet(vals, lookback){
    const s0 = streetId(vals[0]);
    if(!s0) return null;
    for(let i=1;i<Math.min(vals.length, lookback+1);i++) {
      const si = streetId(vals[i]);
      if(si && si===s0) return `Street ${s0} repeated within ${i} spins`;
    }
    return null;
  }
  function repeatCorners(vals, lookback){
    function rc(n){
      if(n==="00"||n===0) return null;
      const v=Number(n);
      const r=Math.floor((v-1)/3)+1;
      const c=((v-1)%3)+1;
      return [r,c];
    }
    function cornerId(n){
      const p=rc(n); if(!p) return null;
      const r=p[0], c=p[1];
      const cr=Math.min(r,11);
      const cc=Math.min(c,2);
      return cr+"-"+cc;
    }
    const id0=cornerId(vals[0]); if(!id0) return null;
    for(let i=1;i<Math.min(vals.length, lookback+1);i++) {
      const idi=cornerId(vals[i]);
      if(idi && idi===id0) return "Corner repeated within "+i+" spins";
    }
    return null;
  }

  function scoreStrategies(vals){
    const w = vals.slice(0,15);
    const c15 = counts(w);
    const ds15 = dsCounts(w);
    const rn = vals.length>=2 ? repeatInfo(vals,5) : null;
    const rs = vals.length>=2 ? repeatStreet(vals,5) : null;

    const tableState = (() => {
      if(rn || rs) return "Repeat-Heavy";
      const colMax=Math.max(c15.c1,c15.c2,c15.c3);
      const dozMax=Math.max(c15.d1,c15.d2,c15.d3);
      const qMax=Math.max(c15.gn,c15.ho,c15.lo,c15.m);
      if(colMax>=7 || dozMax>=7 || qMax>=7) return "Concentrated";
      return "Flat/Choppy";
    })();

    const plays = [];
    const add=(name, lane, score)=>plays.push({name, lane, score});

    add("COMP — 6 Diamonds + 0/00", "COMP", tableState==="Repeat-Heavy" ? 90 : 78);

    const qMax=Math.max(c15.gn,c15.ho,c15.lo,c15.m);
    if(qMax>=6) add("CASH — Junko Hot (Quadrant Momentum)", "CASH", 92);
    else add("CASH — Even-Money Compression", "CASH", 72);

    const mx1=Math.max(...ds15.d1), mx2=Math.max(...ds15.d2), mx3=Math.max(...ds15.d3);
    const dsSum=mx1+mx2+mx3;
    if(dsSum>=8 && (mx1>=3||mx2>=3||mx3>=3)) add("CASH — DS Cash Power", "CASH", 86);

    plays.sort((a,b)=>b.score-a.score);
    const top=plays.slice(0,3);
    const cashQualified = top[0] && top[0].lane==="CASH" && top[0].score>=85;

    return {top, state: tableState, cashQualified};
  }

  const HOWTO = {
    "COMP — 6 Diamonds + 0/00":
`How to play (COMP — 6 Diamonds + 0/00)
• Bet 1 unit on each of 6 fixed corners (coverage).
• Add 0 and 00 as flat singles (optional if table allows).
• Progression: keep flat/minimal (comp-safe). If you insist: +1 unit to all corners after a loss, drop back after a win.
• Stop/Reset: when you recover to near session high or if volatility spikes.`,

    "CASH — Junko Hot (Quadrant Momentum)":
`How to play (CASH — Junko Hot)
• Identify the hottest Junko quadrant over last 15.
• Flat bet a tight subset inside that quadrant (5–7 numbers).
• Short leash: reassess every 10–15 spins; stop if it cools.`,

    "CASH — Even-Money Compression":
`How to play (CASH — Even-Money Compression)
• Choose 1–2 even-money lanes (R/B, H/L, E/O) based on last-15 lean.
• Flat bet only. No chasing.
• Exit quickly if the lean disappears (2 losses in a row is a common stop).`,

    "CASH — DS Cash Power":
`How to play (CASH — DS Cash Power)
• In each dozen, pick the hottest double-street (6-line) from the last 15.
• Bet 1 unit on up to 3 double-streets (one per dozen).
• Flat or very shallow progression only; reset on recovery.`
  };

  function compactStatus(){
    if(spins.length===0) {
      addBubble("No spins yet. Paste history like <span class=\"mono\">0,00,34,23</span>.", "them");
      return;
    }
    const scored = scoreStrategies(spins);
    const top = scored.top;
    let html = "<b>Top strategies</b>";
    html += ` <span class="pill">${escapeHtml(scored.state)}</span>`;
    html += "<hr/>";
    top.forEach((p,i)=>{
      html += `<div><b>${i+1}. ${escapeHtml(p.name)}</b> <span class="pill">${p.lane} • ${p.score}</span></div>`;
    });
    if(scored.cashQualified) html += "<div class=\"meta\">CASH qualified (top is CASH and score ≥ 85).</div>";
    addBubble(html, "them");
  }

  function trendText(){
    if(spins.length===0) { addBubble("No spins yet.", "them"); return; }
    const vals=spins;
    const w = vals.slice(0,15);
    const c = counts(w);
    const ds = dsCounts(w);
    const rep = [];
    const rn = repeatInfo(vals,5); if(rn) rep.push(rn);
    const rs = repeatStreet(vals,5); if(rs) rep.push(rs);
    const rc = repeatCorners(vals,5); if(rc) rep.push(rc);

    let html = '<b>Trend</b> <span class="pill">last 15</span>';
    html += `<div class="mono" style="margin-top:8px">Cols: ${c.c1} / ${c.c2} / ${c.c3}<br/>Doz: ${c.d1} / ${c.d2} / ${c.d3}<br/>R/B: ${c.red} / ${c.black}<br/>H/L: ${c.high} / ${c.low}<br/>E/O: ${c.even} / ${c.odd}<br/>Junko: GN ${c.gn} | HO ${c.ho} | LO ${c.lo} | M ${c.m}<br/>DS: D1 ${ds.d1[0]}/${ds.d1[1]}/${ds.d1[2]} | D2 ${ds.d2[0]}/${ds.d2[1]}/${ds.d2[2]} | D3 ${ds.d3[0]}/${ds.d3[1]}/${ds.d3[2]}</div>`;
    if(rep.length) html += `<div class="meta">Repeats: ${escapeHtml(rep.join(" • "))}</div>`;
    addBubble(html, "them");
  }

  function wheelHistogram(){
    if(spins.length===0) { addBubble("No spins yet.", "them"); return; }
    const slice = spins.slice(0,20);
    const cts = Object.create(null);
    for(const n of slice){
      const k = (n==="00") ? "00" : String(n);
      cts[k] = (cts[k]||0) + 1;
    }
    const bar = (n) => "▮".repeat(n);
    let html = '<b>Wheel histogram</b> <span class="pill">last 20</span><div class="mono" style="margin-top:8px">';
    for(const p of WHEEL){
      const k = (p==="00") ? "00" : String(p);
      const v = cts[k]||0;
      html += `${k.padStart(2," ")}: ${String(v).padStart(2," ")} ${bar(v)}
`;
    }
    html += "</div>";
    addBubble(html, "them");
  }

  function exportCsv(){
    if(spins.length===0) { addBubble("Nothing to export.", "them"); return; }
    const lines = ["number,casino"];
    const cas = (casino||"").replace(/"/g,'""');
    for(const n of spins.slice().reverse()) {
      const k = (n==="00") ? "00" : String(n);
      lines.push(`${k},"${cas}"`);
    }
    const csv = lines.join("\n");
    try {
      navigator.clipboard.writeText(csv).then(()=> {
        addBubble("Exported CSV copied to clipboard.", "them");
      }).catch(()=> {
        addBubble(`Clipboard blocked. Copy this CSV:\n<pre class="mono" style="white-space:pre-wrap">${escapeHtml(csv)}</pre>`, "them");
      });
    } catch(e) {
      addBubble(`Copy this CSV:\n<pre class="mono" style="white-space:pre-wrap">${escapeHtml(csv)}</pre>`, "them");
    }
  }

  function offlineTips(){
    addBubble("<b>Offline reminders</b><br/>• Works without internet (all data stored on-device).<br/>• Use <b>export</b> to copy CSV as a backup.<br/>• Before airplane/cruise mode: open the page once so it is cached in the browser.<br/>• If you clear Safari data, local history is erased—export first.", "them");
  }

  function clearAll(){
    spins = [];
    casino = "";
    awaitingCasino = false;
    save();
    addBubble("Cleared.", "them");
  }

  function setCasinoFromUser(msg){
    casino = msg.trim();
    awaitingCasino = false;
    save();
    addBubble(`Got it. Casino saved: <b>${escapeHtml(casino||"—")}</b>.`, "them");
    compactStatus();
  }

  function handleMessage(raw){
    const msg = String(raw||"").trim();
    if(!msg) return;

    addBubble(escapeHtml(msg), "me");

    if(awaitingCasino){
      setCasinoFromUser(msg);
      return;
    }

    const lower = msg.toLowerCase();

    if(lower === "help") {
      addBubble("<b>Commands</b><br/>• <b>status</b>: top 3 names + scores<br/>• <b>trend</b>: full trend snapshot<br/>• <b>wheel</b>: wheel histogram (last 20)<br/>• <b>explain</b>: how-to for #1 strategy<br/>• <b>explain2</b>: how-to for #2 strategy<br/>• <b>export</b>: copy CSV (local backup)<br/>• <b>offline</b>: offline tips<br/>• <b>clear</b>: wipe local history", "them");
      return;
    }
    if(lower === "status") { compactStatus(); return; }
    if(lower === "trend") { trendText(); return; }
    if(lower === "wheel") { wheelHistogram(); return; }
    if(lower === "export") { exportCsv(); return; }
    if(lower === "offline") { offlineTips(); return; }
    if(lower === "clear") { clearAll(); return; }

    if(lower === "explain" || lower === "explain1") {
      const scored = scoreStrategies(spins);
      const p = scored.top[0];
      const body = p ? (HOWTO[p.name] || ("No how-to found for: " + p.name)) : "No strategy yet.";
      addBubble(`<pre class="mono" style="white-space:pre-wrap">${escapeHtml(body)}</pre>`, "them");
      return;
    }
    if(lower === "explain2") {
      const scored = scoreStrategies(spins);
      const p = scored.top[1];
      const body = p ? (HOWTO[p.name] || ("No how-to found for: " + p.name)) : "No #2 strategy yet.";
      addBubble(`<pre class="mono" style="white-space:pre-wrap">${escapeHtml(body)}</pre>`, "them");
      return;
    }

    if(lower.startsWith("casino ")) {
      casino = msg.slice(7).trim();
      save();
      addBubble(`Casino set: <b>${escapeHtml(casino||"—")}</b>.`, "them");
      return;
    }

    const list = msg.includes(",") ? parseList(msg) : null;
    const single = (!msg.includes(",")) ? parseToken(msg) : null;

    if(list && list.length) {
      spins = list.slice().reverse().concat(spins).slice(0,5000);
      save();
      addBubble(`${list.length} spins imported.`, "them");
      if(!casino){
        awaitingCasino = true;
        addBubble("Which casino are you at? (reply with a name, or type <span class=\"mono\">casino Caesars</span>)", "them");
      } else {
        compactStatus();
      }
      return;
    }

    if(single !== null) {
      spins.unshift(single);
      if(spins.length>5000) spins.length=5000;
      save();
      compactStatus();
      return;
    }

    addBubble("Unrecognized. Send a number like <b>17</b>, a comma list like <span class=\"mono\">0,00,34,23</span>, or type <b>help</b>.", "them");
  }

  form.addEventListener("submit", (e)=>{
    e.preventDefault();
    const v = input.value;
    input.value = "";
    handleMessage(v);
  });

  load();
  addBubble("Ready. Paste history or send a spin. Type <b>help</b> for commands.", "them");
  if(spins.length>0) {
    addBubble(`Loaded ${spins.length} saved spins${casino?(" • "+escapeHtml(casino)):""}.`, "them");
  }
})();
</script>
</body>
</html>
